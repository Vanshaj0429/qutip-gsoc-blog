<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vanshaj Bindal">
<meta name="dcterms.date" content="2025-06-17">

<title>Week 2: Project Pivots, Repository Decisions, and Exploring the Rabi Model – Google Summer of Code 2025 | QuTiP | NumFOCUS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-27ce6193bbbcbee7b7a723ecaba8e1c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Google Summer of Code 2025 | QuTiP | NumFOCUS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Vanshaj Bindal</span>
    </span>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Vanshaj0429"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vanshaj-bindal-487953244/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#key-project-decisions-june-12th-meeting" id="toc-key-project-decisions-june-12th-meeting" class="nav-link active" data-scroll-target="#key-project-decisions-june-12th-meeting">Key Project Decisions (June 12th Meeting)</a>
  <ul class="collapse">
  <li><a href="#timeline-extension-request" id="toc-timeline-extension-request" class="nav-link" data-scroll-target="#timeline-extension-request">Timeline Extension Request</a></li>
  <li><a href="#json-format-parking-the-complexity" id="toc-json-format-parking-the-complexity" class="nav-link" data-scroll-target="#json-format-parking-the-complexity">JSON Format: Parking the Complexity</a></li>
  <li><a href="#repository-strategy-staying-in-qutip-core" id="toc-repository-strategy-staying-in-qutip-core" class="nav-link" data-scroll-target="#repository-strategy-staying-in-qutip-core">Repository Strategy: Staying in QuTiP Core</a></li>
  <li><a href="#design-philosophy-functions-creating-objects" id="toc-design-philosophy-functions-creating-objects" class="nav-link" data-scroll-target="#design-philosophy-functions-creating-objects">Design Philosophy: Functions Creating Objects</a></li>
  </ul></li>
  <li><a href="#exploring-the-rabi-model-beyond-the-rotating-wave-approximation" id="toc-exploring-the-rabi-model-beyond-the-rotating-wave-approximation" class="nav-link" data-scroll-target="#exploring-the-rabi-model-beyond-the-rotating-wave-approximation">Exploring the Rabi Model: Beyond the Rotating Wave Approximation</a>
  <ul class="collapse">
  <li><a href="#the-physics-connection" id="toc-the-physics-connection" class="nav-link" data-scroll-target="#the-physics-connection">The Physics Connection</a></li>
  <li><a href="#when-does-the-difference-matter" id="toc-when-does-the-difference-matter" class="nav-link" data-scroll-target="#when-does-the-difference-matter">When Does the Difference Matter?</a></li>
  <li><a href="#collapse-operators-for-the-rabi-model" id="toc-collapse-operators-for-the-rabi-model" class="nav-link" data-scroll-target="#collapse-operators-for-the-rabi-model">Collapse Operators for the Rabi Model</a></li>
  <li><a href="#implementation-considerations" id="toc-implementation-considerations" class="nav-link" data-scroll-target="#implementation-considerations">Implementation Considerations</a></li>
  </ul></li>
  <li><a href="#development-progress-and-next-steps" id="toc-development-progress-and-next-steps" class="nav-link" data-scroll-target="#development-progress-and-next-steps">Development Progress and Next Steps</a>
  <ul class="collapse">
  <li><a href="#week-4-goals" id="toc-week-4-goals" class="nav-link" data-scroll-target="#week-4-goals">Week 4 Goals</a></li>
  </ul></li>
  <li><a href="#reflections" id="toc-reflections" class="nav-link" data-scroll-target="#reflections">Reflections</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 2: Project Pivots, Repository Decisions, and Exploring the Rabi Model</h1>
  <div class="quarto-categories">
    <div class="quarto-category">GSoC 2025</div>
    <div class="quarto-category">Week 2</div>
    <div class="quarto-category">QuTiP</div>
    <div class="quarto-category">Rabi Model</div>
    <div class="quarto-category">Project Management</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vanshaj Bindal </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Week 2 has been all about making crucial project decisions and expanding our understanding of quantum models. From timeline adjustments to repository strategies, plus a deep dive into the Rabi model and its relationship to the Jaynes-Cummings model, this week laid important groundwork for the path ahead.</p>
<section id="key-project-decisions-june-12th-meeting" class="level2">
<h2 class="anchored" data-anchor-id="key-project-decisions-june-12th-meeting">Key Project Decisions (June 12th Meeting)</h2>
<p>Our Thursday meeting with Eric, Alex, Neill, and myself covered several pivotal decisions that will shape the project’s trajectory:</p>
<section id="timeline-extension-request" class="level3">
<h3 class="anchored" data-anchor-id="timeline-extension-request">Timeline Extension Request</h3>
<p>One of the most significant developments was the decision to request a timeline extension from 12 to 16 weeks. Alex will be reaching out to NumFOCUS to make this request official. This extension is particularly valuable given that I have summer schools scheduled for June 15-20 and August 18-September 5, which will impact my availability during those periods.</p>
<p>The extra 4 weeks will allow for:</p>
<ul>
<li>More thorough development and testing of the quantum systems library</li>
<li>Better integration with QuTiP core</li>
<li>Comprehensive documentation and examples</li>
<li>Buffer time for unexpected challenges (like the JSON serialization complexities we discussed)</li>
</ul>
</section>
<section id="json-format-parking-the-complexity" class="level3">
<h3 class="anchored" data-anchor-id="json-format-parking-the-complexity">JSON Format: Parking the Complexity</h3>
<p>After extensive discussion, the team decided to park the agnostic format (JSON) requirement for now. As noted in the meeting, “not everyone is convinced of the value for this” and “it is not necessary to get started.” This is actually a relief, it allows us to focus on building solid, functional quantum systems first, and we can always add serialization capabilities later if there’s demand.</p>
<p>This decision simplifies the immediate development path significantly and lets us concentrate on the core physics and software architecture.</p>
</section>
<section id="repository-strategy-staying-in-qutip-core" class="level3">
<h3 class="anchored" data-anchor-id="repository-strategy-staying-in-qutip-core">Repository Strategy: Staying in QuTiP Core</h3>
<p>Eric raised an important concern about separate repositories potentially not being maintained long-term. The solution? We’ll develop directly in QuTiP core, within a new <code>quantum_systems</code> folder. Eric will create a development branch called <code>dev.qsystem</code>, and I’ll be pushing commits and PRs to this branch for testing and review.</p>
<p>This approach has several advantages:</p>
<ul>
<li>Ensures long-term maintenance and integration</li>
<li>Makes collaboration with the QuTiP team seamless</li>
<li>Provides immediate access to QuTiP’s existing infrastructure</li>
<li>Facilitates testing with the broader QuTiP ecosystem</li>
</ul>
</section>
<section id="design-philosophy-functions-creating-objects" class="level3">
<h3 class="anchored" data-anchor-id="design-philosophy-functions-creating-objects">Design Philosophy: Functions Creating Objects</h3>
<p>The architectural direction became clearer this week. The main module will contain functions that create structured objects for quantum systems. I’ll be sharing a Jaynes-Cummings example for team review, which will serve as the template for other quantum models.</p>
<p>This function-based approach strikes a nice balance between usability and structure, users get simple function calls, but the underlying system maintains proper object-oriented design for extensibility.</p>
</section>
</section>
<section id="exploring-the-rabi-model-beyond-the-rotating-wave-approximation" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-rabi-model-beyond-the-rotating-wave-approximation">Exploring the Rabi Model: Beyond the Rotating Wave Approximation</h2>
<p>While working on the Jaynes-Cummings implementation, I’ve been diving deep into the Rabi model, which provides fascinating insights into the fundamental atom-field interaction without approximations.</p>
<section id="the-physics-connection" class="level3">
<h3 class="anchored" data-anchor-id="the-physics-connection">The Physics Connection</h3>
<p>The Rabi model is essentially the “parent” of the Jaynes-Cummings model. Where JCM uses the rotating wave approximation to simplify the math, the Rabi model keeps all terms in the interaction:</p>
<p><strong>Rabi Model Hamiltonian:</strong> <span class="math display">H_{Rabi} = \omega_c a^\dagger a + \frac{\omega_a}{2} \sigma_z + g(a^\dagger + a)(\sigma_+ + \sigma_-)</span></p>
<p><strong>Jaynes-Cummings Model (with RWA):</strong> <span class="math display">H_{JC} = \omega_c a^\dagger a + \frac{\omega_a}{2} \sigma_z + g(a^\dagger \sigma_- + a \sigma_+)</span></p>
<p>The key difference is that the Rabi model includes the “counter-rotating” terms <span class="math inline">a^\dagger \sigma_+</span> and <span class="math inline">a \sigma_-</span>, which represent processes that don’t conserve energy (creating a photon while exciting the atom, or destroying a photon while de-exciting the atom).</p>
</section>
<section id="when-does-the-difference-matter" class="level3">
<h3 class="anchored" data-anchor-id="when-does-the-difference-matter">When Does the Difference Matter?</h3>
<p>The rotating wave approximation is valid when <span class="math inline">g \ll \omega_c, \omega_a</span>, meaning the coupling is much weaker than the characteristic frequencies. But in several important scenarios, the Rabi model becomes essential:</p>
<ol type="1">
<li><strong>Strong Coupling Regime</strong>: When <span class="math inline">g</span> approaches <span class="math inline">\omega_c</span> or <span class="math inline">\omega_a</span></li>
<li><strong>Circuit QED</strong>: Superconducting qubits in microwave cavities often reach strong coupling</li>
<li><strong>Ultrastrong Coupling</strong>: Some systems achieve <span class="math inline">g/\omega &gt; 0.1</span>, where the RWA completely breaks down</li>
</ol>
</section>
<section id="collapse-operators-for-the-rabi-model" class="level3">
<h3 class="anchored" data-anchor-id="collapse-operators-for-the-rabi-model">Collapse Operators for the Rabi Model</h3>
<p>For the complete open system description, the Rabi model uses the same dissipation mechanisms as JCM:</p>
<ul>
<li><strong>Cavity decay</strong>: <span class="math inline">C_1 = \sqrt{\kappa (1 + n)} a</span></li>
<li><strong>Atomic decay</strong>: <span class="math inline">C_2 = \sqrt{\gamma} \sigma_-</span></li>
<li><strong>Atomic dephasing</strong>: <span class="math inline">C_3 = \sqrt{\gamma_\phi} \sigma_z</span></li>
</ul>
<p>The master equation structure remains the same, but the Hamiltonian evolution includes the additional oscillating terms that can lead to richer dynamics.</p>
</section>
<section id="implementation-considerations" class="level3">
<h3 class="anchored" data-anchor-id="implementation-considerations">Implementation Considerations</h3>
<p>Including both Rabi and Jaynes-Cummings models in our library provides users with:</p>
<ul>
<li><strong>JCM</strong>: Fast, well-understood dynamics for weak coupling</li>
<li><strong>Rabi</strong>: Accurate physics for strong coupling regimes</li>
<li><strong>Educational value</strong>: Direct comparison of approximations vs exact models</li>
<li><strong>Research flexibility</strong>: Users can easily switch between models</li>
</ul>
<p>The parameter sets are nearly identical, making it easy to implement both and let users choose based on their specific regime of interest.</p>
</section>
</section>
<section id="development-progress-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="development-progress-and-next-steps">Development Progress and Next Steps</h2>
<p>This week’s practical work included:</p>
<ul>
<li>Setting up the development environment for working with QuTiP core</li>
<li>Beginning the Jaynes-Cummings implementation that will serve as our template</li>
<li>Researching the Rabi model as our second quantum system</li>
</ul>
<p><strong>Week 3: I am in Paris for a summer school so will not be working actively on the project.</strong></p>
<section id="week-4-goals" class="level3">
<h3 class="anchored" data-anchor-id="week-4-goals">Week 4 Goals</h3>
<p>The coming week will focus on:</p>
<ul>
<li>Getting the development branch set up and testing the workflow</li>
<li>Finalizing the Jaynes-Cummings implementation</li>
<li>Starting the Rabi model implementation</li>
<li>Creating clear documentation and examples</li>
<li>Testing integration with QuTiP’s existing functionality</li>
</ul>
</section>
</section>
<section id="reflections" class="level2">
<h2 class="anchored" data-anchor-id="reflections">Reflections</h2>
<p>This week felt like a turning point where the project crystallized from abstract planning into concrete development. The decision to park JSON serialization removes a major complexity, while the timeline extension provides breathing room for quality implementation.</p>
<p>The repository decision to stay within QuTiP core is particularly exciting, it means our work will have immediate access to the full QuTiP ecosystem and a clear path to long-term maintenance.</p>
<p>Diving into the Rabi model has also been intellectually rewarding. Understanding how it relates to the Jaynes-Cummings model provides a perfect example of why having a comprehensive quantum systems library matters, researchers need easy access to both approximate and exact models depending on their specific use case.</p>
<hr>
<p><em>Next week: Branch setup, first PR submissions, and implementing the Rabi model alongside our JCM template.</em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>